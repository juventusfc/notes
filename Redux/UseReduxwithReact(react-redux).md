# Use Redux with React(react-redux)

## Presentational(呈现) and Container（容器） Components

|                | Presentational Components        | Container Components                           |
| -------------- | -------------------------------- | ---------------------------------------------- |
| Purpose        | How things look (markup, styles) | How things work (data fetching, state updates) |
| Aware of Redux | No                               | Yes                                            |
| To read data   | Read data from props             | Subscribe to Redux state                       |
| To change data | Invoke callbacks from props      | Dispatch Redux actions                         |
| Are written    | By hand                          | Usually generated by React Redux               |

## 使用 react-redux

第二讲中直接使用`store.subscribe()`来监听 store 以获得最新的 state 值，然后更改 react component。react-redux 提供了`connect()`来方便开发人员使用。

### mapStateToProps()

映射 store 中的 state 到当前 container component 中

```javascript
const getVisibleTodos = (todos, filter) => {
  switch (filter) {
    case 'SHOW_COMPLETED':
      return todos.filter(t => t.completed)
    case 'SHOW_ACTIVE':
      return todos.filter(t => !t.completed)
    case 'SHOW_ALL':
    default:
      return todos
  }
}
​
const mapStateToProps = state => {
  return {
    todos: getVisibleTodos(state.todos, state.visibilityFilter)
  }
}
```

### mapDispatchToProps()

映射 store 中的 dispatch() 到当前 container component 中

```javascript
const mapDispatchToProps = dispatch => {
  return {
    onTodoClick: id => {
      dispatch(toggleTodo(id));
    }
  };
};
```

### connect()生成容器组件

Presentational component:

```javascript
import { connect } from 'react-redux'
​
const VisibleTodoList = connect(
  mapStateToProps,
  mapDispatchToProps
)(TodoList) // 映射关系作为TodoList的props传入
​
export default VisibleTodoList
```

container component:

```javascript
import React from 'react'
import PropTypes from 'prop-types'
import Todo from './Todo'
​
const TodoList = ({ todos, onTodoClick }) => (
  <ul>
    {todos.map((todo, index) => (
      <Todo key={index} {...todo} onClick={() => onTodoClick(index)} />
    ))}
  </ul>
)
​
TodoList.propTypes = {
  todos: PropTypes.arrayOf(
    PropTypes.shape({
      id: PropTypes.number.isRequired,
      completed: PropTypes.bool.isRequired,
      text: PropTypes.string.isRequired
    }).isRequired
  ).isRequired,
  onTodoClick: PropTypes.func.isRequired
}
​
export default TodoList
```

### \<Provider store>给容器组件提供 store

第一步，connect 生成了容器组件，连接了 state（store 端）和 props（组件端）。  
第二步，容器组件需要获得 store,通常使用\<Provider />来完成。如此，Provider 下的所有容器组件都与 store 保持了连接。

```javascript
import React from 'react'
import { render } from 'react-dom'
import { Provider } from 'react-redux'
import { createStore } from 'redux'
import todoApp from './reducers'
import App from './components/App'
​
const store = createStore(todoApp)
​
render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
)
```
